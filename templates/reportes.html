<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes y Estad√≠sticas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 p-6">

    <div class="max-w-6xl mx-auto bg-white p-8 rounded-xl shadow-lg">
        <header class="mb-8 border-b pb-4">
            <h1 class="text-3xl font-bold text-gray-800">üìä Reportes de Rentas e Ingresos</h1>
            <p class="text-gray-500">Datos hist√≥ricos de habitaciones cerradas obtenidos de la base de datos.</p>
        </header>

        <div class="mb-6">
            <a href="{{ url_for('dashboard') }}" class="inline-flex items-center text-indigo-600 hover:text-indigo-800 transition duration-150">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                Volver al Dashboard
            </a>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <div class="bg-gray-50 p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">Ingresos Totales por Tipo de Habitaci√≥n</h2>
                
                <div class="overflow-x-auto mb-6">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"># Rentas</th>
                                <th class="px-6 py-3 text-right text-xs font-font-medium text-gray-500 uppercase tracking-wider">Ingreso Total</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for item in reportes.ingresos_tipo %}
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ item.tipo }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ item.rentas }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-green-600 text-right">${{ "%.2f"|format(item.ingreso) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="h-64">
                    <canvas id="ingresosTipoChart"></canvas>
                </div>
            </div>

            <div class="bg-gray-50 p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">Rentas por Modo de Ingreso</h2>
                
                <div class="overflow-x-auto mb-6">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Modo</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"># Rentas</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for item in reportes.rentas_modo %}
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ item.modo }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">{{ item.rentas }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="h-64">
                    <canvas id="rentasModoChart"></canvas>
                </div>
            </div>

            <div class="lg:col-span-2 bg-gray-50 p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">‚≠ê Top 5 Habitaciones por Renta</h2>
                
                <div class="overflow-x-auto mb-6">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"># Habitaci√≥n</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Veces Rentada</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ingreso Generado</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            {% for item in reportes.top_habitaciones %}
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">{{ item.numero }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ item.rentas }}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-indigo-600 text-right">${{ "%.2f"|format(item.ingreso_total) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="h-64">
                    <canvas id="topHabitacionesChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Convierte el diccionario de Python 'reportes' a un objeto JavaScript
            const reportes = {{ reportes | tojson }};

            // --- GR√ÅFICA 1: Ingresos por Tipo de Habitaci√≥n (Doughnut Chart) ---
            const ctx1 = document.getElementById('ingresosTipoChart').getContext('2d');
            new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: reportes.ingresos_tipo.map(item => item.tipo),
                    datasets: [{
                        label: 'Ingreso Total',
                        data: reportes.ingresos_tipo.map(item => item.ingreso),
                        backgroundColor: [
                            '#4f46e5', // Indigo (Standard)
                            '#22c55e', // Green (Suite)
                            '#f59e0b'  // Amber (Jacuzzi)
                        ],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'Distribuci√≥n de Ingresos por Tipo' }
                    }
                }
            });

            // --- GR√ÅFICA 2: Rentas por Modo de Ingreso (Pie Chart) ---
            const ctx2 = document.getElementById('rentasModoChart').getContext('2d');
            new Chart(ctx2, {
                type: 'pie',
                data: {
                    labels: reportes.rentas_modo.map(item => item.modo),
                    datasets: [{
                        label: 'N√∫mero de Rentas',
                        data: reportes.rentas_modo.map(item => item.rentas),
                        backgroundColor: [
                            '#ef4444', // Red (Efectivo)
                            '#6366f1'  // Violet (Vehiculo)
                        ],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'Rentas por Modo de Ingreso' }
                    }
                }
            });

            // --- GR√ÅFICA 3: Top 5 Habitaciones (Bar Chart) ---
            const ctx3 = document.getElementById('topHabitacionesChart').getContext('2d');
            new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: reportes.top_habitaciones.map(item => Hab. ${item.numero}),
                    datasets: [{
                        label: 'Veces Rentada',
                        data: reportes.top_habitaciones.map(item => item.rentas),
                        backgroundColor: '#3b82f6', // Blue
                        borderColor: '#3b82f6',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: { display: true, text: 'Frecuencia de Renta (Top 5)' }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'N√∫mero de Rentas' } }
                    }
                }
            });
        });
    </script>
</body>
</html>